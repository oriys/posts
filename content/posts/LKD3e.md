---
title: "Linux 内核设计与实现"
date: 2021-05-09T20:42:10+08:00
draft: true
---

# Linux 内核设计与实现

## Linux 内核简介

### Unix 简介

- 时间线
  - 1969 原型机
  - 1971 移植到 PDP-11
  - 1973 用 C 语言进行了重写，Unix V6 版本
  - 1977 贝尔实验室推出了 Unix System III
  - 1977 加州伯克利推出了 1BSD 系统
  - 1978 加州伯克利推出了 2BSD 系统
  - 1979 加州伯克利推出了 3BSD 系统
  - 1983 AT&T 推出了 System V
  - 1996 加州伯克利推出了 4.4BSD 系统
- 特点
  - 简洁，仅提供数百个系统调用并且每个都有明确的设计目的
  - 几乎所有的啥东西都当做文件对待，这种抽象使对数据核对设备的操作是通过一组相同的系统调用接口实现的
  - Unix 的内核和相关系统都是用 C 写成的，拥有惊人的移植能力
  - Unix 的进程创建非常快
  - 提供了一套非常简单但又稳定的进程间通信原语

### Linux 简介

- 类 Unix 系统，借鉴了 Unix 许多优秀的设计，保持接口一致
- 被广泛移植到不同改的体系架构，从手表到超算
- 开源，GPL2 协议，全世界的黑客们都可以参与完善和修改

### 操作系统和内核简介

- 操作系统
  - 内核
  - 设备驱动程序
  - 启动引导程序
  - 命令行 Shell
  - 用户界面
  - 文件管理
  - 系统工具
- 内核
  - 负责响应中断的中断服务程序
  - 负责管理多个进程的调度程序
  - 负责管理进程地址空间的内存管理程序
  - 网络、IPC 等系统服务程序
  - 运行在内核态，拥有受保护的地址空间和对所有设备的访问权限
- 应用程序通过系统调用与内核通信
- 内核负责管理系统的硬件设备
- 中断机制
  - 中断信号 -> 中断号 -> 中断服务 -> 调用这个程序响应和处理中断
  - 为了同步，系统可以不响应部分或所有中断信号
  - 在中断上下文执行，保证第一时间响应并安全退出

### Linux 内核和传统 Unix 内核的比较

- Linux 支持动态加载内核模块
- Linux 支持 SMP 机制
- Linux 内核可以抢占
- Linux 不区分线程和一般进程，对内核来说都一样，只是一部分进程共享资源
- Linux 提供了具有设备类的面向对象的设备模型、热插拔事件
- Linux 忽略了一些过时和难以实现的标准
- Linux 更加自由

### Linux 内核版本

2.6.26.1

主版本号.从版本号.修订版本号.稳定版本号

## 从内核出发

### 获取内核源码

http://www.kernel.org

### 使用 git

```bash
git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux-2.6.git

git pull
```

### 内核开发的特点

- 没有 C 库和没有标准的 C 头文件
- 必须使用 GNU C
  - 内联函数
  - 内联汇编
  - 分支声明
    - likely
    - unlikely
- 没有内存保护机制
- 难以执行浮点运算
- 每个进程只有很小一段定长堆栈
- 异步中断、抢占、SMP，注意同步和并发
- 可移植性
